---
title: Language learnability analyses
author: "Molly Lewis"
date: "`r Sys.Date()`"
output: 
  html_document:
  toc: true
  number_sections: true
---
  
***
***
Across several sets of analyses, I've been looking at the relationship between proxies for learnability pressures and features of language. Here I try to aggregate these analyses.

There are three motivating theoretical ideas. The first is the idea of multiple timescales: We assume there are multiple timescales -- in-the-moment, development, and language evolution -- that are relevant to the phenomenon of language. 

Second, we consider the possibility that language adapts to its contextual niche at all timescales. At the in-the-moment timescales, this might mean taking into account the character of the referential alternatives when formulating an utterance. At the developmental timescale, we assume the learner has acquired a lexicon that is tailored to the child's cognitive capacity. And, at the evolution timescale, we consider the possibility that language systems might adapt over time to the learnability pressures of the population ("Linguistic Niche Hypothesis," Lupyan & Dale, 2011). This might mean, for example, that languages with more adult second language speakers become easier to learn.

The third motivating theory comes from pragmatics: competing communicative pressures that give rise to equilibria. These competeing pressures have been formulated in a number of different ways across the literature, e.g., Horn's Speaker and Hearer pressure. 

The consequences of these pressures have been considered primarily at the timescale of in-the-moment communication. The present work extends the relevance of these pressures to longer timescales. In particuar, these analyses explore the following hypothesis: The same equilibria that emerge as a consequence of communicative pressures at the pragmatic timescale, also emerge at the developmental and language evolution timescales. These analyses try to explore predictions of this hypothesis.

Possible evidence:

1. Parallels between language at ontogeny and evolution in how the system adapts to learnability of the context.
  + How do child lexicons change over time? (what distinguishes lexicons of young children from lexicons of older children?) 
  + Are these same features predicted by learnability pressures across languages?
(e.g. early vocabularies in development have shorter words, just as languages with more L2 speakers have shorter words.)
2. Learnability pressure predicts AOA across languages
3. Learnability pressure related to complexity bias
  + evolang submission
  + norming cdi words for complexity bias
4. Experimental data

  
```{r, echo = F, warning = F, message = F}
rm(list = ls())
library(knitr)
library(ggplot2)
library(langcog)
library(dplyr)
library(tidyr)
library(corrplot)

opts_chunk$set(cache = T, warning = F, message = F)

cor.mtest <- function(mat, conf.level = 0.95) {
  mat <- as.matrix(mat)
  n <- ncol(mat)
  p.mat <- lowCI.mat <- uppCI.mat <- matrix(NA, n, n)
  diag(p.mat) <- 0
  diag(lowCI.mat) <- diag(uppCI.mat) <- 1
  for (i in 1:(n - 1)) {
    for (j in (i + 1):n) {
      tmp <- cor.test(mat[, i], mat[, j], conf.level = conf.level)
      p.mat[i, j] <- p.mat[j, i] <- tmp$p.value
      lowCI.mat[i, j] <- lowCI.mat[j, i] <- tmp$conf.int[1]
      uppCI.mat[i, j] <- uppCI.mat[j, i] <- tmp$conf.int[2]
      }
    }
  return(list(p.mat, lowCI.mat, uppCI.mat))
  }
```

## Learnability and language variables 

Merge together all population learnability features:

* population size (Lupyan & Dale)
* area (Lupyan & Dale)
* number of neighbors (Lupyan & Dale)
* temperature (Lupyan & Dale)
* number of L2 speakers (Bentz)

Read in Lupyan and Dale data
```{r}
ld = read.table("data/lupyan_2010.txt", fill = T, 
               header = T, sep = "\t", na.strings = "*")

# fix language labels
ld$ethnologue_lang_name = tolower(ld$ethnologue_lang_name)
ld$ethnologue_lang_name[ld$ethnologue_lang_name == "standard german"] <- "german"
ld$ethnologue_lang_name[ld$ethnologue_lang_name == "tosk albanian"] <- "albanian"
ld$ethnologue_lang_name[ld$ethnologue_lang_name == "catalan-valencian-balear"] <- "catalan"
ld$ethnologue_lang_name[ld$ethnologue_lang_name == "haitian creole french"] <- "haitian.creole"
ld$ethnologue_lang_name[ld$ethnologue_lang_name == "irish gaelic"] <- "irish"
ld$ethnologue_lang_name[ld$ethnologue_lang_name == "central khmer"] <- "khmer"

# Need to collapse across different dialects of same language (e.g. "eastern mongolian" and "peripherial mongolian") [arabic, azerbaijani, chinese, hmong, mongolian, yiddish]

# but first, remove sign languages (e.g."chinese sign language")
ld = ld[-which(grepl("sign language", ld$ethnologue_lang_name)),]

ld$eln2 = ifelse(grepl("arabic", ld$ethnologue_lang_name), "arabic",
                   ifelse(grepl("azerbaijani", ld$ethnologue_lang_name), "azerbaijani",
                          ifelse(grepl("chinese", ld$ethnologue_lang_name), "chinese",
                                 ifelse(grepl("hmong", ld$ethnologue_lang_name), "hmong",
                                        ifelse(grepl("mongolian", ld$ethnologue_lang_name), "mongolian",
                                               ifelse(grepl("yiddish", ld$ethnologue_lang_name), "yiddish",
                                                      ld$ethnologue_lang_name))))))
ld$eln2 = as.factor(ld$eln2)

# 12 langs not in lupyan 2010, but in LF [belarusian, bosnian, cebuana, croatian, esperanto, filipino, kanada, latin, norwegian, persian, punjabi, serbian]

# get means across language
demo_ld = ld %>%
     group_by(eln2) %>%
     summarise_each(funs(mean(., na.rm = TRUE)), 
                    c(8:9, 16:121))  %>%
     select(1, 93:95, 100:101, 103:105, 108)

# add in data family
fams = ld %>%
      group_by(eln2) %>%
      filter(row_number() == 1) %>%
      select(eln2, langFamily, langGenus)  

demo_ld = left_join(fams, demo_ld, by = "eln2") %>%
          rename(language = eln2) %>%
          ungroup()
```

Read in Bentz data (Note here that we are only looking at languages from the UDHR corpus. The other corpora have smaller languages only.)
```{r}
demo_bentz = read.csv("data/bentz_2015.csv") %>%
    gather(temp, LDT, starts_with("LDT")) %>% 
    unite(temp1, measure, temp, sep = ".") %>% 
    spread(temp1, LDT) %>%
    filter(text == "UDHR") %>%
    select(-iso_639_3, -fileName, 
           -contains("Stock"), -contains("speakers"),
           -contains("Region"), -text,
           -genus_wals, -family_wals)  %>%
    mutate(Language = gsub("[[:space:]]", "", tolower(Language))) %>%
    rename(language = Language)

demo_bentz$language[demo_bentz$language == "swahili,tanzania"] <- "swahili"
demo_bentz$language[demo_bentz$language == "irishgaelic"] <- "irish"
```

Join all population variables
```{r}
demo = left_join(demo_ld, demo_bentz, by="language") %>%
       mutate(language = as.factor(language))
```


Merge together all linguistic features:

 * complexity bias (Lewis & Frank)
 * mean length (Lewis & Frank)
 * dependency length (Futrell)
 * number of words (Bentz)
 * type-token ratio (Bentz)
 * uid-ness (Pelligrino)
 * morphological complexity (Lupyan & Dale) -- missing
 * semantic variables? e.g. conceretness -- missing
 
```{r}
# Complexity bias
cb = read.csv("data/lewis_2015.csv") %>%
      rename(complexity.bias = corr,
              p.complexity.bias = p.corr,
              mono.complexity.bias = mono.cor,
              open.complexity.bias = open.cor) %>%
    select(-X.1, -X, -lower.ci, -upper.ci, -checked)

# dependency length
dl = read.csv("data/futrell_2015.csv")

# UID
uid = read.csv("data/pellegrino_2015.csv")
```

Merge population with all language
```{r}
d = left_join(demo, cb) %>%
    left_join(dl) %>%
    left_join(uid) %>%
    mutate(language = as.factor(language))
```

Now let's start the analysis. First, let's look at the
distributions of social variables 
```{r}
d[,c(1,4:14)] %>%
    gather(variable, num, 2:12)  %>%
    ggplot(aes(x=num)) + 
      geom_histogram(position="identity") +
      facet_wrap( ~ variable, scales = "free") + 
      theme_bw()
```

Let's take the log of of the non-normal-looking variables and re-plot

```{r}

d = d %>%
    mutate(log.area = log(area),
              log.perimeter = log(perimeter),
              log.numNeighbors = log(numNeighbors),
              log.sumPrecip = log(sumPrecip),
              log.sdTemp = log(sdTemp),
              log.sdPrecip = log(sdPrecip),
              log.RatioL2= log(RatioL2)) %>%
    select(-area, -perimeter, -numNeighbors, -sdTemp,
           -sdPrecip, -RatioL2, -sumPrecip)

d[,c(1,4:7, 31:37)]%>%
    gather(variable, num, 2:12)  %>%
    ggplot(aes(x=num)) + 
      geom_histogram(position="identity") +
      facet_wrap( ~ variable, scales = "free") + 
      theme_bw()

pop_vars = names(d)[c(4:7, 31:37)]
```

Now, let's at how many languages we have for each measure
```{r, fig.height = 6}
d[,c(1,8:30)] %>%
    gather(variable, num, 2:24)  %>%
    group_by(variable) %>%
    summarize(counts = length(which(is.na(num) == FALSE)))  %>%
    ggplot(aes(y=counts, x = variable, fill = variable, order = variable)) + 
      geom_bar(stat = "identity") +
      theme_bw() +
      theme(axis.text.x = element_text(angle = 90, hjust = 1),
            legend.position = "none") +
      ggtitle("Number languages per measure")
```

```{r, fig.width = 10, fig.height = 10}
d[,c(1,8:30)] %>%
    gather(variable, num, 2:24)  %>%
    ggplot(aes(x=num)) + 
      geom_histogram(position="identity") +
      facet_wrap( ~ variable, scales = "free") + 
      theme_bw()
```

Add in AOA data
```{r}
aoa_data = read.csv("data/aoa_data.csv") %>%
          filter( aoa > 5 & aoa < 31) 

aoa_central = aoa_data %>% 
  mutate(language = tolower(language)) %>%
  filter(measure == "understands", lexical_category == "nouns") %>%
  group_by(language) %>%
  summarise(mean_aoa = mean(aoa))
  
d2 = left_join(d, aoa_central, by = "language") %>%
  select(log.RatioL2, logpop2, log.numNeighbors, log.area, 
         aveTemp, p.complexity.bias, mean.length, 
         m_obs, TTR.LDT,information.density,
         syllable.rate, information.rate)
is.na(d2) <- sapply(d2, is.infinite)
```

Look at correlations -- stuff in the upper right quadrant matters
```{r}
corrs = cor(d2, use = "pairwise.complete.obs")
corrplot(corrs)
```

Look at scatter plot
```{r, fig.width=10, fig.height = 10}
d2 = left_join(d, aoa_central, by = "language") %>%
  mutate(log.mean.length = log(mean.length)) %>%
  select(language,log.RatioL2, logpop2,
         log.numNeighbors, log.area, aveTemp, p.complexity.bias, 
         log.mean.length, 
         m_obs, TTR.LDT) %>%
  filter(language != "english")
  
m = d2 %>% 
  gather(lang_measure, lang_value, 7:10) %>%
  group_by(lang_measure) %>%
  gather(pop_measure, pop_value, 2:6)


ggplot(m, aes(x = pop_value, y = lang_value, label = language)) +
      geom_point()+
      geom_smooth(method = "lm") +
      theme_bw()+ 
      facet_grid(lang_measure~pop_measure, scale = "free")
```

```{r, fig.width=10, fig.height = 10, eval = F}
d2 = left_join(d, aoa_central, by = "language") %>%
  mutate(log.mean.length = log(mean.length)) %>%
  select(language,log.RatioL2, logpop2, log.numNeighbors, log.area, 
         aveTemp,information.density,
         syllable.rate, information.rate) %>%
  filter(language != "english")
  
m = d2 %>% 
  gather(lang_measure, lang_value, 7:9) %>%
  group_by(lang_measure) %>%
  gather(pop_measure, pop_value, 2:6)

ggplot(m, aes(x = pop_value, y = lang_value, label = language)) +
      geom_point()+
      geom_smooth(method = "lm") +
      theme_bw()+ 
      facet_grid(lang_measure~pop_measure, scale = "free")
```

## Parallels between language ontogeny and evolution
get measures of developmental change in vocabulary

## Learnability pressures predicts AOA across languages
Predict AOA by social variables, by social variable
```{r, fig.width=10, fig.height = 10}

aoa_central = aoa_data %>% 
  mutate(language = tolower(language)) %>%
  group_by(language, measure, lexical_category) %>%
  summarise(mean_aoa = mean(aoa))
  
d3 = inner_join(d, aoa_central, by = "language") %>%
  select(language, log.RatioL2, logpop2,
         log.numNeighbors, log.area, 
         aveTemp, mean_aoa, measure, lexical_category) %>%
  mutate(language = as.factor(language)) %>%
  gather(pop_measure, pop_value, 2:6) 

ggplot(d3, aes(y = mean_aoa, 
              x = pop_value,
              label = language,
              group = measure,
              color = measure)) +
  geom_text(size = 3, aes(group = measure)) +
  facet_grid(lexical_category ~ pop_measure, scales = "free") +
  geom_smooth(method = "lm") +
  theme_bw() 
````
